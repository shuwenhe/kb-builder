# å®Œæ•´ç³»ç»Ÿæ¶æ„è®¾è®¡ - 6æ­¥åˆ†è§£æ–¹æ¡ˆ

**é¡¹ç›®ç›®æ ‡**: æ„å»ºä¸€ä¸ªå®Œæ•´çš„çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ  
**è®¾è®¡æ–¹é’ˆ**: æŒ‰ç…§åŠŸèƒ½æ‹†åˆ†æˆæ¯ä¸ªå¯ä»¥è¿è¡Œçš„å­é¡¹ç›®ï¼ŒæŒ‰ç…§å¼€å‘çš„å…ˆåé¡ºåºé€æ­¥æ„å»º  
**æ€»ä½“è¿›åº¦**: âœ… Step 1-3 å®Œæˆ | â³ Step 4-6 å¾…å¼€å‘

---

## ğŸ“ ç³»ç»Ÿå…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢ (Customer Service Web)                 â”‚
â”‚                          Step 6: Frontend                             â”‚
â”‚  (React/Vue + Next.js, é—®ç­”ç•Œé¢, æ–‡æ¡£ç®¡ç†, ç”¨æˆ·è®¤è¯)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/REST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡API (Customer Service API)                     â”‚
â”‚                         Step 5: Backend                              â”‚
â”‚  (FastAPI, ç”¨æˆ·ç®¡ç†, é—®ç­”å†å², æƒé™æ§åˆ¶, æ—¥å¿—è®°å½•)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   RAG    â”‚   â”‚   ç”¨æˆ·   â”‚   â”‚   é—®ç­”   â”‚
        â”‚ Service  â”‚   â”‚   æ•°æ®åº“ â”‚   â”‚   å†å²   â”‚
        â”‚(Step 4)  â”‚   â”‚  (MySQL) â”‚   â”‚  (Redis) â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   KB Loader  â”‚  â”‚ Query Embedder   â”‚
â”‚  (Step 3)    â”‚  â”‚  (Step 2)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚
    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FAISS Index â”‚  â”‚ Embedding Models â”‚
â”‚  (Vector DB) â”‚  â”‚ (Ollama/OpenAI)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–²
    â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KB Builder      â”‚
â”‚  (Step 3)        â”‚
â”‚  æ„å»ºå‘é‡ç´¢å¼•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document Parser â”‚ â—„â”€â”€â”€ æºæ–‡æ¡£
â”‚ (Step 1)        â”‚     (Docs/)
â”‚ è§£ææ–‡æ¡£ç»“æ„    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¨ è¯¦ç»†æ¶æ„åˆ†è§£

### ç¬¬1æ­¥: Document Parser (docx-parser) âœ…

**ç›®æ ‡**: å°†å„ç§æ ¼å¼çš„æ–‡æ¡£è½¬æ¢ä¸ºç»“æ„åŒ–çš„å†…å®¹

**èŒè´£**:
```
è¾“å…¥: .docx, .doc, .pdf, .md, .txt ç­‰æ–‡ä»¶
  â†“
è§£æé€»è¾‘:
  â”œâ”€ è¯†åˆ«æ–‡æ¡£ç»“æ„ (æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼)
  â”œâ”€ æå–æ–‡æœ¬å†…å®¹
  â”œâ”€ ä¿ç•™æ ¼å¼ä¿¡æ¯ (ç²—ä½“ã€æ–œä½“ã€é“¾æ¥)
  â””â”€ ç”Ÿæˆå…ƒæ•°æ® (ä½œè€…ã€åˆ›å»ºæ—¶é—´ç­‰)
  â†“
è¾“å‡º: DocContent å¯¹è±¡
  {
    filename: str,
    title: str,
    blocks: List[Block]  # å—åŒ…å«ç±»å‹ã€å†…å®¹ã€æ ¼å¼ä¿¡æ¯
    metadata: Dict
  }
```

**æ ¸å¿ƒæ¨¡å—**:
```python
# docx-parser/parser.py
class DocContent:
    filename: str
    blocks: List[Block]
    metadata: Dict

class Block:
    block_type: str  # "heading", "paragraph", "table", "list", etc.
    level: int  # æ ‡é¢˜çº§åˆ«
    text: str
    metadata: Dict

def parse_docx(path: str) -> DocContent:
    """è§£æ DOCX æ–‡ä»¶"""
    
def parse_pdf(path: str) -> DocContent:
    """è§£æ PDF æ–‡ä»¶"""
    
def parse_markdown(path: str) -> DocContent:
    """è§£æ Markdown æ–‡ä»¶"""
```

**ç‰¹ç‚¹**:
- âœ… ä¿ç•™æ–‡æ¡£å±‚çº§å…³ç³»ï¼ˆæ ‡é¢˜-å†…å®¹æ ‘ï¼‰
- âœ… æ”¯æŒå¤šç§æ ¼å¼
- âœ… æä¾›ç»“æ„åŒ–è¾“å‡º

**è¾“å‡ºç¤ºä¾‹**:
```json
{
  "filename": "user_guide.docx",
  "blocks": [
    {"type": "heading", "level": 1, "text": "ç”¨æˆ·æŒ‡å—"},
    {"type": "heading", "level": 2, "text": "å¿«é€Ÿå¼€å§‹"},
    {"type": "paragraph", "text": "é¦–å…ˆå®‰è£…..."},
    {"type": "list", "items": ["æ­¥éª¤1", "æ­¥éª¤2"]},
    {"type": "table", "rows": [[...], [...]]},
    {"type": "heading", "level": 2, "text": "å¸¸è§é—®é¢˜"},
    ...
  ]
}
```

---

### ç¬¬2æ­¥: Embedding Service (embedding-service) âœ…

**ç›®æ ‡**: å°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤º

**èŒè´£**:
```
è¾“å…¥: æ–‡æœ¬å­—ç¬¦ä¸² (å•æ¡æˆ–æ‰¹é‡)
  â†“
åµŒå…¥è¿‡ç¨‹:
  â”œâ”€ é€‰æ‹©åµŒå…¥æ¨¡å‹ (mxbai-embed-large, text-embedding-3-small, etc.)
  â”œâ”€ è¿æ¥åµŒå…¥æœåŠ¡ (Ollama, OpenAI, Azure, etc.)
  â”œâ”€ å‘é€æ–‡æœ¬è¿›è¡ŒåµŒå…¥
  â”œâ”€ æ¥æ”¶1024ç»´å‘é‡
  â””â”€ è¿”å›å‘é‡ç»“æœ
  â†“
è¾“å‡º: numpy.ndarray (N, 1024)
```

**æ ¸å¿ƒæ¨¡å—**:
```python
# embedding-service/embedding_service.py
from langchain.embeddings.base import Embeddings

class OllamaEmbeddings(Embeddings):
    """Ollama æœ¬åœ°åµŒå…¥"""
    
    def embed_documents(texts: List[str]) -> List[List[float]]:
        """æ‰¹é‡åµŒå…¥æ–‡æ¡£"""
        
    def embed_query(query: str) -> List[float]:
        """å•æ¡åµŒå…¥æŸ¥è¯¢"""

class OpenAIEmbeddings(Embeddings):
    """OpenAI API åµŒå…¥"""

def build_embeddings(provider: str, model: str, **config) -> Embeddings:
    """å·¥å‚å‡½æ•°ï¼šæ ¹æ® provider åˆ›å»ºåµŒå…¥å¯¹è±¡"""
```

**REST API**:
```python
from fastapi import FastAPI

app = FastAPI()

@app.post("/embed")
async def embed(texts: List[str]) -> List[List[float]]:
    """æ‰¹é‡åµŒå…¥"""
    
@app.post("/embed-query")
async def embed_query(query: str) -> List[float]:
    """å•æ¡åµŒå…¥"""
```

**ç‰¹ç‚¹**:
- âœ… ç»Ÿä¸€æ¥å£æ”¯æŒå¤šä¸ª provider (Ollama, OpenAI, Azure)
- âœ… æ”¯æŒæ‰¹é‡å’Œå•æ¡åµŒå…¥
- âœ… å¯ä»¥ä½œä¸ºåº“æˆ– REST æœåŠ¡ä½¿ç”¨
- âœ… ä¸ LangChain é›†æˆ

**æ€§èƒ½æŒ‡æ ‡**:
```
æ¨¡å‹: mxbai-embed-large (1024ç»´)
- å•æ¡åµŒå…¥: ~100ms (GPUåŠ é€Ÿ)
- æ‰¹é‡åµŒå…¥ (32æ¡): ~200ms
- ååé‡: ~150-300 æ¡æ–‡æœ¬/ç§’
```

---

### ç¬¬3æ­¥: KB Builder (kb-builder) âœ… å·²å®Œæˆ

**ç›®æ ‡**: å°†è§£æçš„æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡ç´¢å¼•åº“

**èŒè´£**:
```
è¾“å…¥: 
  â”œâ”€ æºæ–‡æ¡£ç›®å½• (source_dir)
  â”œâ”€ åµŒå…¥å‡½æ•° (embedding_fn)
  â””â”€ é…ç½®å‚æ•° (chunk_size, overlap, etc.)
  â†“
æ„å»ºæµç¨‹ (6 ä¸ªé˜¶æ®µ):
  â”œâ”€ é˜¶æ®µ1: æ‰«ææ–‡æ¡£
  â”œâ”€ é˜¶æ®µ2: è§£ææ–‡æ¡£ (è°ƒç”¨ Step 1)
  â”œâ”€ é˜¶æ®µ3: æ™ºèƒ½åˆ†å— (æŒ‰æ®µè½ã€åˆ—è¡¨ã€è¡¨æ ¼)
  â”œâ”€ é˜¶æ®µ4: åµŒå…¥å‘é‡ (è°ƒç”¨ Step 2)
  â”œâ”€ é˜¶æ®µ5: æ„å»º FAISS ç´¢å¼•
  â””â”€ é˜¶æ®µ6: ç‰ˆæœ¬ç®¡ç† (ç¬¦å·é“¾æ¥åˆ‡æ¢)
  â†“
è¾“å‡ºç›®å½•ç»“æ„:
  kb/
  â”œâ”€ 20250128_120530/  (ç‰ˆæœ¬1)
  â”‚  â”œâ”€ index.faiss     (å‘é‡ç´¢å¼•)
  â”‚  â”œâ”€ chunks.jsonl    (å—å…ƒæ•°æ®)
  â”‚  â””â”€ manifest.json   (é…ç½®ä¿¡æ¯)
  â”œâ”€ 20250128_140000/  (ç‰ˆæœ¬2)
  â”‚  â””â”€ ...
  â””â”€ latest â†’ 20250128_140000  (å½“å‰ç‰ˆæœ¬ç¬¦å·é“¾æ¥)
```

**æ ¸å¿ƒç±»**:
```python
# kb_builder/builder.py
class BuildConfig:
    max_len: int = 800
    overlap: int = 100
    batch_size: int = 32
    
def build_kb(
    source_dir: str,
    out_dir: str,
    embedding_fn: Callable,
    config: BuildConfig
) -> Manifest:
    """ä¸»æ„å»ºå‡½æ•°"""

# kb_builder/loader.py
class KnowledgeBase:
    index: faiss.Index
    chunks: Dict[int, ChunkRecord]
    manifest: Manifest
    
def load_kb(kb_dir: str) -> KnowledgeBase:
    """åŠ è½½çŸ¥è¯†åº“"""
```

**å·¥ä½œæµç¤ºä¾‹**:
```python
from kb_builder import build_kb, load_kb
from embedding_service import build_embeddings

# 1ï¸âƒ£ æ„å»º KB
embeddings = build_embeddings(provider="ollama", model="mxbai-embed-large")
manifest = build_kb(
    source_dir="./docs",
    out_dir="./kb",
    embedding_fn=embeddings.embed_documents
)

# 2ï¸âƒ£ åŠ è½½ KB
kb = load_kb("./kb")

# 3ï¸âƒ£ æŸ¥è¯¢
query_vec = embeddings.embed_query("ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ")
distances, indices = kb.index.search(np.array([query_vec]), k=5)

for idx in indices[0]:
    chunk = kb.chunks[idx]
    print(f"ğŸ“„ {chunk.file_path}: {chunk.excerpt_markdown}")
```

**ç‰¹ç‚¹**:
- âœ… é›†æˆ Step 1 (docx-parser) å’Œ Step 2 (embedding-service)
- âœ… æ™ºèƒ½åˆ†å—ä¿ç•™ä¸Šä¸‹æ–‡
- âœ… å®¹é”™å¤„ç† (éƒ¨åˆ†å¤±è´¥ä¸å½±å“æ•´ä½“)
- âœ… åŸå­æ€§ç‰ˆæœ¬åˆ‡æ¢ (é›¶åœæœºæ›´æ–°)
- âœ… 100% æµ‹è¯•è¦†ç›–

---

### ç¬¬4æ­¥: RAG Service (rag-service) â³ å¾…å¼€å‘

**ç›®æ ‡**: å®ç°æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval Augmented Generation)

**èŒè´£**:
```
è¾“å…¥: ç”¨æˆ·æŸ¥è¯¢æ–‡æœ¬
  â†“
RAG æµç¨‹:
  â”œâ”€ æŸ¥è¯¢å‘é‡åŒ–
  â”‚  â””â”€ è°ƒç”¨ Step 2: embedding_service.embed_query(query)
  â”‚
  â”œâ”€ å‘é‡æ£€ç´¢
  â”‚  â””â”€ è°ƒç”¨ Step 3: kb.index.search(query_vec, k=5)
  â”‚
  â”œâ”€ æ£€ç´¢å—ç»„ç»‡
  â”‚  â””â”€ æ•´ç†å‰ k ä¸ªç›¸ä¼¼å—ä½œä¸ºä¸Šä¸‹æ–‡
  â”‚
  â”œâ”€ LLM ç”Ÿæˆ
  â”‚  â””â”€ ç”¨æ£€ç´¢çš„ä¸Šä¸‹æ–‡ + æŸ¥è¯¢æç¤º LLM ç”Ÿæˆå›ç­”
  â”‚
  â””â”€ ç»“æœè¿”å›
     â””â”€ è¿”å›å›ç­” + æºå¼•ç”¨
  â†“
è¾“å‡º: 
{
  "answer": "æœºå™¨å­¦ä¹ æ˜¯...",
  "sources": [
    {"file": "ML_Guide.docx", "chunk_id": "abc123", "text": "..."},
    {"file": "ML_Guide.docx", "chunk_id": "def456", "text": "..."}
  ],
  "confidence": 0.85
}
```

**æ ¸å¿ƒæ¨¡å—**:
```python
# rag_service/rag_engine.py
class RAGEngine:
    def __init__(self, kb: KnowledgeBase, llm_model: str):
        self.kb = kb
        self.llm = build_chat_model(model=llm_model)
        self.embeddings = build_embeddings()
    
    def query(self, query: str, k: int = 5) -> Dict:
        """
        æ‰§è¡Œ RAG æŸ¥è¯¢
        
        æ­¥éª¤:
        1. å‘é‡åŒ–æŸ¥è¯¢
        2. FAISS æ£€ç´¢
        3. ç»„ç»‡ä¸Šä¸‹æ–‡
        4. LLM ç”Ÿæˆ
        5. è¿”å›ç»“æœ
        """
        # 1ï¸âƒ£ å‘é‡åŒ–
        query_vec = self.embeddings.embed_query(query)
        
        # 2ï¸âƒ£ æ£€ç´¢
        distances, indices = self.kb.index.search(
            np.array([query_vec]), k=k
        )
        
        # 3ï¸âƒ£ æ•´ç†ä¸Šä¸‹æ–‡
        context = ""
        sources = []
        for idx, dist in zip(indices[0], distances[0]):
            chunk = self.kb.chunks[idx]
            context += f"\n{chunk.excerpt_markdown}\n"
            sources.append({
                "file": chunk.file_path,
                "score": float(dist)
            })
        
        # 4ï¸âƒ£ ç”Ÿæˆå›ç­”
        prompt = f"""æ ¹æ®ä»¥ä¸‹å‚è€ƒèµ„æ–™å›ç­”é—®é¢˜ã€‚

å‚è€ƒèµ„æ–™:
{context}

é—®é¢˜: {query}

ç­”æ¡ˆ:"""
        
        response = self.llm.invoke(prompt)
        
        # 5ï¸âƒ£ è¿”å›
        return {
            "answer": response.content,
            "sources": sources
        }

# FastAPI æœåŠ¡
from fastapi import FastAPI

app = FastAPI()
rag_engine = RAGEngine(
    kb=load_kb("./kb"),
    llm_model="qwen2.5:7b"
)

@app.post("/query")
async def query(query: str, k: int = 5) -> Dict:
    return rag_engine.query(query, k)

@app.post("/chat")
async def chat(query: str, chat_history: List[Dict]) -> Dict:
    """æ”¯æŒå¤šè½®å¯¹è¯"""
    # å®ç°å¤šè½®å¯¹è¯é€»è¾‘
    pass
```

**é›†æˆå…³ç³»**:
```
rag-service
  â”œâ”€ ä¾èµ– kb-builder (Step 3)
  â”‚  â””â”€ åŠ è½½çŸ¥è¯†åº“ + å‘é‡ç´¢å¼•
  â”‚
  â”œâ”€ ä¾èµ– embedding-service (Step 2)
  â”‚  â””â”€ å‘é‡åŒ–æŸ¥è¯¢
  â”‚
  â””â”€ æ–°å¢ç»„ä»¶
     â”œâ”€ LLM è°ƒç”¨ (Ollama, OpenAI)
     â”œâ”€ ä¸Šä¸‹æ–‡ç»„ç»‡
     â””â”€ å¤šè½®å¯¹è¯ç®¡ç†
```

**API è®¾è®¡**:
```
POST /query
{
  "query": "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ",
  "k": 5,
  "llm_model": "qwen2.5:7b",
  "temperature": 0.7
}

Response:
{
  "answer": "æœºå™¨å­¦ä¹ æ˜¯...",
  "sources": [
    {
      "file": "ML_Guide.docx",
      "chunk_id": "abc123",
      "similarity_score": 0.92,
      "text": "..."
    }
  ],
  "tokens_used": 1250,
  "latency_ms": 3450
}
```

**ç‰¹ç‚¹**:
- âœ… å®Œæ•´çš„ RAG ç®¡é“å®ç°
- âœ… æ”¯æŒå¤šç§ LLM åç«¯
- âœ… REST API æœåŠ¡
- âœ… å¤šè½®å¯¹è¯æ”¯æŒ
- âœ… ç»“æœæº¯æº

---

### ç¬¬5æ­¥: Customer Service API (customer-service-api) â³ å¾…å¼€å‘

**ç›®æ ‡**: æä¾›ä¸šåŠ¡çº§åˆ«çš„ APIï¼ŒåŒ…å«è®¤è¯ã€ç”¨æˆ·ç®¡ç†ã€å†å²è®°å½•ç­‰

**èŒè´£**:
```
è¾“å…¥: HTTP è¯·æ±‚ (å¸¦ç”¨æˆ·ä¿¡æ¯ã€è¯·æ±‚å†…å®¹)
  â†“
æ ¸å¿ƒåŠŸèƒ½:
  â”œâ”€ ç”¨æˆ·è®¤è¯ (JWT Token, OAuth)
  â”œâ”€ é—®ç­”è¯·æ±‚å¤„ç†
  â”‚  â””â”€ è°ƒç”¨ Step 4: RAG Service
  â”œâ”€ å†å²è®°å½•ç®¡ç† (Redis/Database)
  â”œâ”€ åé¦ˆæ”¶é›† (å¯¹å›ç­”è¿›è¡Œæ‰“åˆ†)
  â”œâ”€ çŸ¥è¯†åº“ç®¡ç† (ä¸Šä¼ æ–‡æ¡£ã€æ„å»ºæ–° KB)
  â”œâ”€ æ—¥å¿—å’Œç›‘æ§
  â””â”€ é€Ÿç‡é™åˆ¶ (Rate Limiting)
  â†“
è¾“å‡º: JSON å“åº”
```

**æ ¸å¿ƒæ¨¡å—**:
```python
# customer_service_api/api.py
from fastapi import FastAPI, Depends, HTTPException
from fastapi.security import HTTPBearer

app = FastAPI()
security = HTTPBearer()

# ä¾èµ–: RAG Service å®¢æˆ·ç«¯
rag_client = RAGServiceClient("http://rag-service:8000")

# ==================== è®¤è¯ ====================
@app.post("/auth/login")
async def login(username: str, password: str) -> Dict:
    """ç”¨æˆ·ç™»å½•"""
    # éªŒè¯ç”¨æˆ·
    # ç”Ÿæˆ JWT Token
    
@app.post("/auth/logout")
async def logout(token: str = Depends(security)) -> Dict:
    """ç”¨æˆ·ç™»å‡º"""

# ==================== é—®ç­”åŠŸèƒ½ ====================
@app.post("/chat")
async def chat(
    query: str,
    token: str = Depends(security),
    k: int = 5
) -> Dict:
    """ä¸»é—®ç­”æ¥å£"""
    user = verify_token(token)
    
    # è°ƒç”¨ RAG Service
    result = rag_client.query(query, k=k)
    
    # ä¿å­˜åˆ°å†å²è®°å½•
    save_chat_history(user.id, query, result)
    
    # è¿”å›ç»“æœ
    return result

@app.post("/feedback")
async def submit_feedback(
    query_id: str,
    score: int,  # 1-5
    comment: str = "",
    token: str = Depends(security)
) -> Dict:
    """ç”¨æˆ·åé¦ˆ"""

@app.get("/chat-history")
async def get_chat_history(
    limit: int = 20,
    token: str = Depends(security)
) -> List[Dict]:
    """è·å–èŠå¤©å†å²"""

# ==================== çŸ¥è¯†åº“ç®¡ç† ====================
@app.post("/kb/upload")
async def upload_documents(
    files: List[UploadFile],
    token: str = Depends(security)
) -> Dict:
    """ä¸Šä¼ æ–‡æ¡£"""
    # éªŒè¯æƒé™
    # ä¿å­˜æ–‡æ¡£
    # è§¦å‘ KB é‡å»º

@app.post("/kb/rebuild")
async def rebuild_kb(
    token: str = Depends(security)
) -> Dict:
    """é‡å»ºçŸ¥è¯†åº“"""
    # è°ƒç”¨ KB Builder
    
@app.get("/kb/status")
async def get_kb_status() -> Dict:
    """è·å– KB çŠ¶æ€"""

@app.get("/kb/documents")
async def list_documents(
    token: str = Depends(security)
) -> List[Dict]:
    """åˆ—å‡ºçŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£"""

# ==================== ç›‘æ§å’Œæ—¥å¿— ====================
@app.get("/metrics")
async def get_metrics(token: str = Depends(security)) -> Dict:
    """è·å–æœåŠ¡æŒ‡æ ‡"""
    
@app.get("/logs")
async def get_logs(
    limit: int = 100,
    token: str = Depends(security)
) -> List[Dict]:
    """è·å–æ“ä½œæ—¥å¿—"""
```

**æ•°æ®æ¨¡å‹**:
```python
# customer_service_api/models.py
from pydantic import BaseModel
from datetime import datetime

class User(BaseModel):
    id: str
    username: str
    email: str
    created_at: datetime
    role: str  # "admin", "user", "guest"

class ChatRecord(BaseModel):
    id: str
    user_id: str
    query: str
    answer: str
    sources: List[Dict]
    feedback_score: Optional[int]
    created_at: datetime

class Document(BaseModel):
    id: str
    filename: str
    file_path: str
    upload_time: datetime
    uploader_id: str
    kb_version: str
    status: str  # "indexing", "indexed", "failed"

class KBStatus(BaseModel):
    version: str
    total_documents: int
    total_chunks: int
    last_update: datetime
    status: str  # "ready", "building", "error"
```

**é›†æˆå…³ç³»**:
```
customer-service-api
  â”œâ”€ ä¾èµ– rag-service (Step 4)
  â”‚  â””â”€ é—®ç­”æ ¸å¿ƒé€»è¾‘
  â”‚
  â”œâ”€ ä¾èµ– kb-builder (Step 3)
  â”‚  â””â”€ çŸ¥è¯†åº“ç®¡ç†
  â”‚
  â”œâ”€ æ–°å¢ç»„ä»¶
  â”‚  â”œâ”€ ç”¨æˆ·è®¤è¯ (OAuth/JWT)
  â”‚  â”œâ”€ æ•°æ®åº“ (MySQL/PostgreSQL)
  â”‚  â”œâ”€ ç¼“å­˜ (Redis)
  â”‚  â”œâ”€ æ—¥å¿— (ELK Stack)
  â”‚  â””â”€ ç›‘æ§ (Prometheus)
  â”‚
  â””â”€ å¤–éƒ¨æœåŠ¡
     â”œâ”€ MySQL ç”¨æˆ·æ•°æ®åº“
     â”œâ”€ Redis ç¼“å­˜å±‚
     â””â”€ æ¶ˆæ¯é˜Ÿåˆ— (å¯é€‰: å¼‚æ­¥ä»»åŠ¡)
```

**API ç«¯ç‚¹æ±‡æ€»**:
```
è®¤è¯:
  POST /auth/login
  POST /auth/logout
  POST /auth/refresh

é—®ç­”:
  POST /chat
  GET /chat-history
  POST /feedback
  GET /feedback-stats

çŸ¥è¯†åº“:
  POST /kb/upload
  POST /kb/rebuild
  GET /kb/status
  GET /kb/documents
  DELETE /kb/documents/{doc_id}

ç®¡ç†:
  GET /metrics
  GET /logs
  GET /health
```

**ç‰¹ç‚¹**:
- âœ… å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å±‚
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- âœ… å†å²è®°å½•ç®¡ç†
- âœ… çŸ¥è¯†åº“ç®¡ç†
- âœ… ç›‘æ§å’Œå¯è§‚æµ‹æ€§

---

### ç¬¬6æ­¥: Customer Service Web (customer-service-web) â³ å¾…å¼€å‘

**ç›®æ ‡**: æä¾›ç”¨æˆ·å‹å¥½çš„ Web ç•Œé¢

**èŒè´£**:
```
ç»„ä»¶:
  â”œâ”€ é—®ç­”ç•Œé¢ (Chat UI)
  â”‚  â”œâ”€ è¾“å…¥æ¡† + å‘é€æŒ‰é’®
  â”‚  â”œâ”€ æ¶ˆæ¯å†å²æ˜¾ç¤º
  â”‚  â”œâ”€ æºæ–‡æ¡£å¼•ç”¨
  â”‚  â””â”€ å›ç­”è´¨é‡åé¦ˆ
  â”‚
  â”œâ”€ çŸ¥è¯†åº“ç®¡ç†ç•Œé¢
  â”‚  â”œâ”€ æ–‡æ¡£ä¸Šä¼ 
  â”‚  â”œâ”€ æ–‡æ¡£åˆ—è¡¨
  â”‚  â”œâ”€ KB ç‰ˆæœ¬ç®¡ç†
  â”‚  â””â”€ æ„å»ºè¿›åº¦æ˜¾ç¤º
  â”‚
  â”œâ”€ ç”¨æˆ·ç®¡ç†ç•Œé¢ (ä»…ç®¡ç†å‘˜)
  â”‚  â”œâ”€ ç”¨æˆ·åˆ—è¡¨
  â”‚  â”œâ”€ æƒé™ç®¡ç†
  â”‚  â””â”€ å®¡è®¡æ—¥å¿—
  â”‚
  â”œâ”€ ä¸ªäººä¸­å¿ƒ
  â”‚  â”œâ”€ é—®ç­”å†å²
  â”‚  â”œâ”€ æ”¶è—çš„é—®é¢˜
  â”‚  â”œâ”€ ä¸ªäººè®¾ç½®
  â”‚  â””â”€ API Key ç®¡ç†
  â”‚
  â””â”€ ç›‘æ§é¢æ¿ (ä»…ç®¡ç†å‘˜)
     â”œâ”€ æœåŠ¡çŠ¶æ€
     â”œâ”€ æ€§èƒ½æŒ‡æ ‡
     â”œâ”€ é”™è¯¯æ—¥å¿—
     â””â”€ ç”¨æˆ·åˆ†æ
```

**æŠ€æœ¯æ ˆ**:
```
å‰ç«¯æ¡†æ¶: React / Vue 3 / Svelte
å…ƒæ¡†æ¶: Next.js (æ¨è) / Nuxt / SvelteKit
UI åº“: Tailwind CSS, shadcn/ui, Material-UI
çŠ¶æ€ç®¡ç†: Redux, Zustand, Pinia
å®æ—¶é€šä¿¡: WebSocket (ç”¨äºæµå¼å›ç­”)
API é€šä¿¡: fetch / axios / TanStack Query
```

**æ ¸å¿ƒç»„ä»¶ç»“æ„**:
```
customer-service-web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx          # å…¨å±€å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx            # é¦–é¡µ
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ page.tsx        # é—®ç­”é¡µé¢
â”‚   â”‚   â””â”€â”€ [id]/           # å¯¹è¯è¯¦æƒ…
â”‚   â”œâ”€â”€ kb-management/
â”‚   â”‚   â”œâ”€â”€ page.tsx        # KB ç®¡ç†
â”‚   â”‚   â””â”€â”€ documents/      # æ–‡æ¡£åˆ—è¡¨
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ page.tsx        # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ settings/       # è®¾ç½®
â”‚   â””â”€â”€ admin/              # ç®¡ç†åå°
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatBox.tsx         # èŠå¤©æ¡†
â”‚   â”œâ”€â”€ SourcesList.tsx     # æºæ–‡æ¡£åˆ—è¡¨
â”‚   â”œâ”€â”€ DocumentUpload.tsx   # æ–‡æ¡£ä¸Šä¼ 
â”‚   â”œâ”€â”€ KBStatus.tsx        # KB çŠ¶æ€
â”‚   â”œâ”€â”€ UserList.tsx        # ç”¨æˆ·åˆ—è¡¨
â”‚   â””â”€â”€ Charts.tsx          # ç»Ÿè®¡å›¾è¡¨
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useChat.ts          # èŠå¤©é€»è¾‘
â”‚   â”œâ”€â”€ useAuth.ts          # è®¤è¯é€»è¾‘
â”‚   â””â”€â”€ useKB.ts            # KB ç®¡ç†é€»è¾‘
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api-client.ts       # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ websocket.ts        # WebSocket è¿æ¥
â”‚   â””â”€â”€ storage.ts          # æœ¬åœ°å­˜å‚¨
â”‚
â””â”€â”€ styles/
    â””â”€â”€ globals.css         # å…¨å±€æ ·å¼
```

**ä¸»è¦é¡µé¢ç¤ºä¾‹**:

#### é—®ç­”é¡µé¢ (Chat Page)
```tsx
export default function ChatPage() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [query, setQuery] = useState("");
  const [loading, setLoading] = useState(false);
  const { sendQuery } = useChat();
  
  const handleSendQuery = async () => {
    setLoading(true);
    const response = await sendQuery(query);
    setMessages([
      ...messages,
      { role: "user", content: query },
      { role: "assistant", content: response.answer, sources: response.sources }
    ]);
    setQuery("");
    setLoading(false);
  };
  
  return (
    <div className="flex flex-col h-screen">
      {/* æ¶ˆæ¯å†å² */}
      <div className="flex-1 overflow-auto p-4">
        {messages.map((msg, idx) => (
          <ChatMessage key={idx} message={msg} />
        ))}
      </div>
      
      {/* è¾“å…¥æ¡† */}
      <div className="border-t p-4">
        <div className="flex gap-2">
          <input
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."
            className="flex-1 px-4 py-2 border rounded"
            onKeyDown={(e) => e.key === "Enter" && handleSendQuery()}
          />
          <button
            onClick={handleSendQuery}
            disabled={loading}
            className="px-6 py-2 bg-blue-500 text-white rounded"
          >
            {loading ? "å‘é€ä¸­..." : "å‘é€"}
          </button>
        </div>
      </div>
    </div>
  );
}
```

#### çŸ¥è¯†åº“ç®¡ç†é¡µé¢
```tsx
export default function KBManagementPage() {
  const [documents, setDocuments] = useState<Document[]>([]);
  const [rebuilding, setRebuilding] = useState(false);
  const { uploadDocuments, rebuildKB, getDocuments } = useKB();
  
  useEffect(() => {
    loadDocuments();
  }, []);
  
  const loadDocuments = async () => {
    const docs = await getDocuments();
    setDocuments(docs);
  };
  
  const handleUpload = async (files: File[]) => {
    await uploadDocuments(files);
    loadDocuments();
  };
  
  const handleRebuild = async () => {
    setRebuilding(true);
    await rebuildKB();
    setRebuilding(false);
    loadDocuments();
  };
  
  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold mb-8">çŸ¥è¯†åº“ç®¡ç†</h1>
      
      {/* ä¸Šä¼ åŒº */}
      <DocumentUpload onUpload={handleUpload} />
      
      {/* æ–‡æ¡£åˆ—è¡¨ */}
      <div className="mt-8">
        <h2 className="text-xl font-bold mb-4">æ–‡æ¡£åˆ—è¡¨</h2>
        <DocumentList documents={documents} />
      </div>
      
      {/* é‡å»ºæŒ‰é’® */}
      <button
        onClick={handleRebuild}
        disabled={rebuilding}
        className="mt-4 px-6 py-2 bg-green-500 text-white rounded"
      >
        {rebuilding ? "é‡å»ºä¸­..." : "é‡å»ºçŸ¥è¯†åº“"}
      </button>
    </div>
  );
}
```

**API é›†æˆ**:
```typescript
// lib/api-client.ts
class APIClient {
  constructor(baseURL: string, token?: string) {
    this.client = axios.create({
      baseURL,
      headers: { Authorization: `Bearer ${token}` }
    });
  }
  
  async chat(query: string, k: number = 5) {
    return this.client.post("/chat", { query, k });
  }
  
  async uploadDocuments(files: File[]) {
    const formData = new FormData();
    files.forEach(f => formData.append("files", f));
    return this.client.post("/kb/upload", formData);
  }
  
  async getChatHistory() {
    return this.client.get("/chat-history");
  }
}
```

**ç‰¹ç‚¹**:
- âœ… ç°ä»£åŒ–çš„ React/Vue UI
- âœ… å®æ—¶èŠå¤©ä½“éªŒ
- âœ… çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
- âœ… ç”¨æˆ·è®¤è¯é›†æˆ
- âœ… å“åº”å¼è®¾è®¡
- âœ… æ€§èƒ½ä¼˜åŒ– (Code Splitting, Lazy Loading)

---

## ğŸ”„ æ•°æ®æµå’Œé›†æˆ

### ç«¯åˆ°ç«¯æ•°æ®æµ

```
1ï¸âƒ£ ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
   User â†’ Web (Step 6) â†’ API (Step 5) â†’ KB Builder (Step 3)
   
2ï¸âƒ£ æ„å»ºçŸ¥è¯†åº“
   KB Builder (Step 3) 
     â”œâ”€ è°ƒç”¨ docx-parser (Step 1) è§£ææ–‡æ¡£
     â”œâ”€ è°ƒç”¨ embedding-service (Step 2) ç”Ÿæˆå‘é‡
     â”œâ”€ æ„å»º FAISS ç´¢å¼•
     â””â”€ è¿”å› Manifest ä¿¡æ¯ç»™ API (Step 5)

3ï¸âƒ£ ç”¨æˆ·å‘èµ·æŸ¥è¯¢
   User â†’ Web (Step 6) â†’ API (Step 5) â†’ RAG Service (Step 4)
   
4ï¸âƒ£ RAG å¤„ç†æµç¨‹
   RAG Service (Step 4)
     â”œâ”€ è°ƒç”¨ embedding-service (Step 2) å‘é‡åŒ–æŸ¥è¯¢
     â”œâ”€ è°ƒç”¨ KB Loader (Step 3) åŠ è½½çŸ¥è¯†åº“
     â”œâ”€ ä½¿ç”¨ FAISS æ£€ç´¢ç›¸ä¼¼å—
     â”œâ”€ ç”¨æ£€ç´¢ç»“æœè°ƒç”¨ LLM ç”Ÿæˆå›ç­”
     â””â”€ è¿”å›å›ç­” + æºå¼•ç”¨ç»™ API (Step 5)

5ï¸âƒ£ è¿”å›ç»“æœç»™ç”¨æˆ·
   RAG Service (Step 4) â†’ API (Step 5) â†’ Web (Step 6) â†’ User
```

### æœåŠ¡ä¾èµ–å…³ç³»

```
Web (Step 6)
    â†“ (REST API)
API (Step 5)
    â”œâ”€ â†“
    â”‚ RAG Service (Step 4)
    â”‚    â”œâ”€ â†“
    â”‚    â”‚ KB Builder Loader (Step 3)
    â”‚    â”‚    â”œâ”€ FAISS Index
    â”‚    â”‚    â””â”€ chunks.jsonl
    â”‚    â”‚
    â”‚    â””â”€ â†“
    â”‚      embedding-service (Step 2)
    â”‚
    â”œâ”€ â†“
    â”‚ KB Builder (Step 3)
    â”‚    â”œâ”€ â†“
    â”‚    â”‚ docx-parser (Step 1)
    â”‚    â”‚
    â”‚    â””â”€ â†“
    â”‚      embedding-service (Step 2)
    â”‚
    â””â”€ â†“
     Database (MySQL)
     Cache (Redis)
```

---

## ğŸ“Š éƒ¨ç½²æ¶æ„

### æœ¬åœ°å¼€å‘

```
localhost:3000   â† Next.js Web
         â†“ (http://localhost:8005)
localhost:8005   â† FastAPI Customer Service API
         â”œâ”€ â†“ (http://localhost:8004)
         â”‚ localhost:8004 â† FastAPI RAG Service
         â”‚         â”œâ”€ â†“
         â”‚         â”‚ ./kb (FAISS Index)
         â”‚         â”‚
         â”‚         â””â”€ â†“ (HTTP)
         â”‚           localhost:11434 (Ollama)
         â”‚
         â”œâ”€ â†“
         â”‚ localhost:3306 (MySQL)
         â”‚
         â””â”€ â†“
           localhost:6379 (Redis)
```

### ç”Ÿäº§éƒ¨ç½² (Docker Compose)

```yaml
version: "3"

services:
  # å‰ç«¯
  web:
    build: ./customer-service-web
    ports:
      - "3000:3000"
    depends_on:
      - api
    environment:
      NEXT_PUBLIC_API_URL: http://api:8005

  # ä¸šåŠ¡ API
  api:
    build: ./customer-service-api
    ports:
      - "8005:8000"
    depends_on:
      - rag-service
      - mysql
      - redis
    environment:
      RAG_SERVICE_URL: http://rag-service:8004
      DATABASE_URL: mysql://root:pass@mysql:3306/kb_db
      REDIS_URL: redis://redis:6379

  # RAG æœåŠ¡
  rag-service:
    build: ./rag-service
    ports:
      - "8004:8000"
    depends_on:
      - ollama
    volumes:
      - ./kb:/app/kb
    environment:
      OLLAMA_BASE_URL: http://ollama:11434

  # Ollama (LLM + Embedding)
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama

  # æ•°æ®åº“
  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: kb_db
    volumes:
      - mysql_data:/var/lib/mysql

  # ç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  ollama_data:
  mysql_data:
  redis_data:
```

---

## ğŸ¯ é¡¹ç›®è¿›åº¦è¿½è¸ª

| æ­¥éª¤ | é¡¹ç›®å | æè¿° | çŠ¶æ€ | æµ‹è¯• | æ–‡æ¡£ |
|-----|--------|------|------|------|------|
| 1 | docx-parser | æ–‡æ¡£è§£æ | âœ… | âœ… | âœ… |
| 2 | embedding-service | å‘é‡åµŒå…¥ | âœ… | âœ… | âœ… |
| 3 | kb-builder | çŸ¥è¯†åº“æ„å»º | âœ… | âœ… 11/11 | âœ… |
| 4 | rag-service | RAG æŸ¥è¯¢ | â³ å¾…å¼€å‘ | - | - |
| 5 | customer-service-api | ä¸šåŠ¡ API | â³ å¾…å¼€å‘ | - | - |
| 6 | customer-service-web | Web å‰ç«¯ | â³ å¾…å¼€å‘ | - | - |

---

## ğŸ“ å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆåˆ†æˆ 6 ä¸ªæ­¥éª¤ï¼Ÿ

âœ… **è§£è€¦**: æ¯ä¸ªæ­¥éª¤ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²  
âœ… **é‡ç”¨**: æ¯ä¸ªæ­¥éª¤å¯ä»¥å•ç‹¬ä½¿ç”¨æˆ–ç»„åˆ  
âœ… **çµæ´»**: å¯ä»¥æ›¿æ¢å…¶ä¸­ä»»ä½•ä¸€æ­¥çš„å®ç°  
âœ… **å¯æµ‹è¯•**: æ¸…æ™°çš„è¾“å…¥/è¾“å‡ºæ¥å£ä¾¿äºæµ‹è¯•  

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨ FAISSï¼Ÿ

- æœ€å¿«çš„å¼€æºå‘é‡æ£€ç´¢åº“
- æ”¯æŒ GPU åŠ é€Ÿ (faiss-gpu)
- æ”¯æŒå¤šç§é‡åŒ–æ–¹å¼ (PQ, IVF)
- Python æ˜“ç”¨æ€§å¥½

### 3. ä¸ºä»€ä¹ˆæ”¯æŒ Ollama + OpenAIï¼Ÿ

- Ollama: æœ¬åœ°éƒ¨ç½²ï¼Œéšç§æ€§å¥½ï¼Œæˆæœ¬ä½
- OpenAI: API è°ƒç”¨ï¼Œä½“éªŒå¥½ï¼Œæ¨¡å‹å¼ºå¤§
- çµæ´»åˆ‡æ¢ï¼Œä¸è¢«é”å®š

### 4. ä¸ºä»€ä¹ˆä½¿ç”¨ FastAPIï¼Ÿ

- æ€§èƒ½é«˜ (å¼‚æ­¥æ”¯æŒ)
- è‡ªåŠ¨ API æ–‡æ¡£ (Swagger/OpenAPI)
- ç±»å‹æ£€æŸ¥ (Pydantic)
- æ˜“äºæ‰©å±•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘æ¨¡å¼

```bash
# 1ï¸âƒ£ å¯åŠ¨ Ollama
ollama serve

# 2ï¸âƒ£ æ‹‰å–æ¨¡å‹
ollama pull mxbai-embed-large
ollama pull qwen2.5:3b

# 3ï¸âƒ£ å¯åŠ¨ MySQL å’Œ Redis
docker-compose -f docker-compose.dev.yml up

# 4ï¸âƒ£ æ„å»ºçŸ¥è¯†åº“
cd kb-builder
python example_build.py

# 5ï¸âƒ£ å¯åŠ¨ RAG æœåŠ¡ (åç»­)
cd rag-service
uvicorn main:app --reload --port 8004

# 6ï¸âƒ£ å¯åŠ¨ API (åç»­)
cd customer-service-api
uvicorn main:app --reload --port 8005

# 7ï¸âƒ£ å¯åŠ¨ Web (åç»­)
cd customer-service-web
npm run dev
```

### æµ‹è¯•å·¥ä½œæµ

```bash
# æµ‹è¯• Step 1: docx-parser
cd docx-parser
pytest

# æµ‹è¯• Step 2: embedding-service
cd embedding-service
pytest

# æµ‹è¯• Step 3: kb-builder
cd kb-builder
make test

# æµ‹è¯• Step 4-6 (åç»­)
cd rag-service && pytest
cd customer-service-api && pytest
cd customer-service-web && npm test
```

---

## æ€»ç»“

è¿™ä¸ªé¡¹ç›®é‡‡ç”¨äº†**å¾®æœåŠ¡æ¶æ„**çš„æ€æƒ³ï¼Œä½†ä½¿ç”¨äº†æ›´è½»é‡çº§çš„å®ç°æ–¹å¼ï¼š

- **æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ç‹¬ç«‹çš„ Python/Node.js é¡¹ç›®**
- **é€šè¿‡ REST API è¿›è¡Œé€šä¿¡**
- **æ”¯æŒæœ¬åœ°å¼€å‘å’Œ Docker éƒ¨ç½²**
- **é€æ­¥æ„å»ºï¼Œå¯ä»¥éšæ—¶åœæ­¢å’Œç»§ç»­**

ä» Step 1 å¼€å§‹ï¼Œæ¯ä¸€æ­¥éƒ½ï¼š
1. æœ‰æ¸…æ™°çš„è¾“å…¥è¾“å‡º
2. æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
3. å¯ä»¥ç‹¬ç«‹è¿è¡Œå’Œä½¿ç”¨
4. æ–‡æ¡£é½å…¨

è¿™æ ·åšçš„å¥½å¤„ï¼š
âœ… å­¦ä¹ æˆæœ¬ä½ (æ¯æ¬¡åªå…³æ³¨ä¸€ä¸ªæ­¥éª¤)  
âœ… å¼€å‘æ•ˆç‡é«˜ (å¯ä»¥å¹¶è¡Œå¼€å‘)  
âœ… ç³»ç»Ÿç¨³å®šæ€§å¥½ (æ¨¡å—åŒ–è®¾è®¡)  
âœ… ç”Ÿäº§å°±ç»ª (æ¯ä¸ªæ¨¡å—éƒ½ç»è¿‡éªŒè¯)  

**ä¸‹ä¸€æ­¥**: å¼€å§‹ Step 4 (rag-service) çš„å¼€å‘ï¼

